<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>åå¤å±‹ç­†è¨˜ 2026</title>
    
    <!-- PWA Settings -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#fcfcfc">
    <link rel="manifest" href="data:application/manifest+json;base64,eyJuYW1lIjoi5ZCN5Y+p5bGLMjAyNiIsInNob3J0X25hbWUiOiLlkI3lj6nlcLEiLCJzdGFydF91cmwiOiIuLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiNmY2ZjZmMiLCJ0aGVtZV9jb2xvciI6IiNmY2ZjZmMiLCJpY29ucyI6W3sic3JjIjoiaHR0cHM6Ly9jZG4tZnJvbnRlLmRlZXBsLmNvbS9pbWFnZXMvbG9nb3MvZGVlcGwuc3ZnIiwic2l6ZXMiOiIxOTJ4MTkyIiwidHlwZSI6ImltYWdlL3BuZyJ9XX0=">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- QRCode Lib -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <style>
        /* ================== é¢¨æ ¼å®šç¾© (CSS Variables for Theming) ================== */
        :root {
            --paper-bg: #fcfcfc;
            --ink-color: #1a1a1a;
            --card-bg: #ffffff;
            --grid-line: #e5e5e5;
            --accent-blue: #eff6ff;
            --accent-yellow: #fefce8;
            --shadow-color: rgba(0,0,0,0.1);
            --shadow-offset: 3px;
        }

        [data-theme="dark"] {
            --paper-bg: #18181b;
            --ink-color: #e4e4e7;
            --card-bg: #27272a;
            --grid-line: #3f3f46;
            --accent-blue: #1e3a8a;
            --accent-yellow: #713f12;
            --shadow-color: #000;
        }

        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: var(--paper-bg);
            background-image: 
                linear-gradient(var(--grid-line) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-line) 1px, transparent 1px);
            background-size: 20px 20px;
            color: var(--ink-color);
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none;
            transition: background-color 0.3s, color 0.3s;
        }

        .app-shell {
            max-width: 480px;
            margin: 0 auto;
            background: var(--paper-bg);
            min-height: 100vh;
            border-left: 2px solid var(--ink-color);
            border-right: 2px solid var(--ink-color);
            position: relative;
            padding-bottom: 90px;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
            transition: background 0.3s;
        }

        .sketch-card {
            background: var(--card-bg);
            border: 2px solid var(--ink-color);
            border-radius: 12px;
            box-shadow: var(--shadow-offset) var(--shadow-offset) 0px 0px var(--ink-color);
            transition: transform 0.1s, box-shadow 0.1s, background 0.3s;
        }
        .sketch-card:active {
            transform: translate(1px, 1px);
            box-shadow: 1px 1px 0px 0px var(--ink-color);
        }

        .sketch-box {
            background: var(--card-bg);
            border: 2px solid var(--ink-color);
            border-radius: 12px;
            box-shadow: var(--shadow-offset) var(--shadow-offset) 0px 0px var(--shadow-color);
            transition: background 0.3s;
        }

        .sketch-input {
            border: 2px solid var(--ink-color);
            border-radius: 8px;
            outline: none;
            background: var(--card-bg);
            color: var(--ink-color);
            box-shadow: inset 2px 2px 4px rgba(0,0,0,0.05);
            transition: background 0.2s;
        }
        .sketch-input:focus { background-color: var(--accent-yellow); }

        /* Dark Mode Overrides */
        [data-theme="dark"] .bg-white { background-color: var(--card-bg); }
        [data-theme="dark"] .bg-gray-100 { background-color: #3f3f46; }
        [data-theme="dark"] .bg-blue-50 { background-color: #172554; color: #dbeafe; }
        [data-theme="dark"] .bg-yellow-50 { background-color: #422006; color: #fef3c7; }
        [data-theme="dark"] .bg-red-50 { background-color: #450a0a; color: #ffe4e6; }
        [data-theme="dark"] .bg-green-100 { background-color: #064e3b; color: #d1fae5; }
        [data-theme="dark"] .bg-pink-100 { background-color: #831843; color: #fce7f3; }
        [data-theme="dark"] .bg-amber-100 { background-color: #78350f; color: #fef3c7; }
        [data-theme="dark"] .text-gray-500, [data-theme="dark"] .text-gray-600 { color: #a1a1aa; }
        [data-theme="dark"] .text-gray-400 { color: #71717a; }
        [data-theme="dark"] .text-blue-800 { color: #bfdbfe; }
        [data-theme="dark"] .text-red-600 { color: #fca5a5; }
        [data-theme="dark"] .border-gray-300 { border-color: #52525b; }

        /* Navigation */
        .bottom-nav {
            position: fixed; bottom: 0; left: 50%; transform: translateX(-50%);
            width: 100%; max-width: 476px; background: var(--card-bg);
            border-top: 2px solid var(--ink-color);
            display: flex; justify-content: space-around; padding: 10px 0 20px;
            z-index: 100; transition: background 0.3s;
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: #9ca3af; font-weight: 700; font-size: 0.7rem; transition: all 0.2s; position: relative;
        }
        .nav-item i { font-size: 1.25rem; margin-bottom: 2px; }
        .nav-item.active { color: var(--ink-color); transform: translateY(-2px); }

        /* Page */
        .page-content { display: none; animation: fadeIn 0.3s ease-out; padding: 1.5rem; padding-bottom: 6rem; }
        .page-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Timeline & Map */
        .timeline-line {
            position: absolute; left: 24px; top: 0; bottom: 0; width: 3px;
            background: repeating-linear-gradient(to bottom, var(--ink-color), var(--ink-color) 6px, transparent 6px, transparent 12px);
            z-index: 0;
        }
        .timeline-travel {
            position: relative; margin-left: 50px; margin-bottom: 20px; margin-top: -10px;
            font-size: 0.65rem; color: #666; background: #f3f4f6;
            display: inline-block; padding: 2px 8px; border-radius: 12px;
            border: 1px dashed #ccc; z-index: 1;
        }
        [data-theme="dark"] .timeline-travel { background: #27272a; color: #a1a1aa; border-color: #52525b; }

        .map-container {
            position: relative; width: 100%; height: 400px;
            background-color: var(--accent-yellow);
            background-image: radial-gradient(#d6d3d1 1px, transparent 1px);
            background-size: 20px 20px;
            border: 2px solid var(--ink-color); border-radius: 12px;
            overflow: hidden; margin-top: 20px; margin-bottom: 20px;
        }
        [data-theme="dark"] .map-container { background-color: #3f3f46; background-image: radial-gradient(#52525b 1px, transparent 1px); }
        
        .path-line {
            stroke-dasharray: 8, 4; stroke-dashoffset: 1000;
            animation: drawLine 3s forwards ease-in-out;
            stroke-linecap: round; stroke-linejoin: round;
        }
        @keyframes drawLine { to { stroke-dashoffset: 0; } }
        .station-label {
            text-shadow: 2px 2px 0 var(--card-bg), -1px -1px 0 var(--card-bg), 1px -1px 0 var(--card-bg), -1px 1px 0 var(--card-bg);
            font-family: 'Zen Maru Gothic', sans-serif;
            font-weight: 900;
        }

        .map-frame {
            width: 100%; height: 200px; border: 2px solid var(--ink-color); border-radius: 12px; overflow: hidden; margin-top: 10px;
        }

        /* Expenses */
        .expense-row {
            border-bottom: 1px dashed #ccc; padding: 8px 0; display: flex; justify-content: space-between; align-items: center;
        }
        .expense-row:last-child { border-bottom: none; }

        /* Stickman */
        .stickman-arm { transform-origin: 25px 20px; animation: waveArm 0.6s ease-in-out infinite alternate; }
        @keyframes waveArm { from { transform: rotate(-10deg); } to { transform: rotate(25deg); } }

        /* Modal */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); z-index: 200;
            display: none; justify-content: center; align-items: center; backdrop-filter: blur(3px);
        }
        .modal-content {
            background: var(--card-bg); width: 90%; max-width: 400px;
            border: 2px solid var(--ink-color); border-radius: 15px;
            box-shadow: 4px 4px 0 var(--ink-color); padding: 20px; position: relative; color: var(--ink-color);
            animation: popUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popUp { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>

    <!-- Shared SVG Defs -->
    <svg width="0" height="0" style="position:absolute">
        <defs>
            <marker id="arrow-blue" markerWidth="5" markerHeight="5" refX="4" refY="2.5" orient="auto" markerUnits="strokeWidth">
                <path d="M0,0 L5,2.5 L0,5" fill="none" stroke="#38bdf8" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </marker>
            <marker id="arrow-pink" markerWidth="5" markerHeight="5" refX="4" refY="2.5" orient="auto" markerUnits="strokeWidth">
                <path d="M0,0 L5,2.5 L0,5" fill="none" stroke="#ec4899" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </marker>
            <marker id="arrow-green" markerWidth="5" markerHeight="5" refX="4" refY="2.5" orient="auto" markerUnits="strokeWidth">
                <path d="M0,0 L5,2.5 L0,5" fill="none" stroke="#4ade80" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </marker>
            <filter id="dropShadow" x="-20%" y="-20%" width="140%" height="140%">
                <feGaussianBlur in="SourceAlpha" stdDeviation="1"/>
                <feOffset dx="1" dy="1" result="offsetblur"/>
                <feComponentTransfer><feFuncA type="linear" slope="0.3"/></feComponentTransfer>
                <feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
        </defs>
    </svg>

    <div class="app-shell">
        
        <!-- HEADER -->
        <div class="sticky top-0 bg-opacity-95 border-b-2 border-dashed border-gray-300 z-40 p-4 flex justify-between items-center backdrop-blur-sm" style="background-color: var(--card-bg);">
            <div>
                <h1 class="text-2xl font-black tracking-tight flex items-center gap-2">
                    <span>åå¤å±‹</span>
                    <span class="text-xs bg-black text-white px-2 py-1 rounded rotate-3 inline-block">2026</span>
                </h1>
                <p id="smart-status" class="text-[10px] font-bold text-blue-500 mt-0.5 animate-pulse">æº–å‚™å‡ºç™¼ï¼</p>
            </div>
            <div class="flex gap-3">
                <div id="page-title-icon" class="w-10 h-10 border-2 border-black rounded-full flex items-center justify-center bg-yellow-400 text-black shadow-[2px_2px_0_0_#000]">
                    <i class="fas fa-plane"></i>
                </div>
                <button onclick="toggleTheme()" class="w-10 h-10 border-2 border-black rounded-full flex items-center justify-center bg-gray-800 text-yellow-400 shadow-[2px_2px_0_0_#000]">
                    <i id="theme-icon" class="fas fa-moon"></i>
                </button>
            </div>
        </div>

        <!-- ================= PAGE: PLAN ================= -->
        <div id="page-plan" class="page-content active">
            
            <!-- Flight Info -->
            <div class="sketch-box p-3 bg-blue-50 mb-6 relative overflow-hidden">
                <div class="flex justify-between items-center relative z-10">
                    <div class="flex-1">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="bg-blue-600 text-white text-[10px] px-1 rounded">å»ç¨‹</span>
                            <span class="text-xs font-bold">IT 778 (3/02)</span>
                            <span class="text-[10px] font-mono ml-1">16:45-20:25</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="bg-orange-500 text-white text-[10px] px-1 rounded">å›ç¨‹</span>
                            <span class="text-xs font-bold">IT 779 (3/06)</span>
                            <span class="text-[10px] font-mono ml-1">13:15-15:25</span>
                        </div>
                    </div>
                    <div class="text-2xl opacity-20"><i class="fas fa-plane-departure"></i></div>
                </div>
                <div class="mt-3 pt-2 border-t border-blue-200 border-dashed">
                    <div class="text-[10px] text-blue-500 font-bold mb-1">è·é›¢å‡ºç™¼é‚„æœ‰ï¼š</div>
                    <div id="countdown-timer" class="text-lg font-black text-blue-800 font-mono tracking-tighter">Loading...</div>
                </div>
            </div>

            <!-- Transit Links -->
            <div class="flex gap-3 mb-6">
                <a href="https://transit.yahoo.co.jp/" target="_blank" class="flex-1 sketch-card p-2 flex items-center justify-center gap-2 hover:opacity-80">
                    <i class="fas fa-train text-green-600"></i>
                    <span class="text-xs font-bold">Yahoo! ä¹˜æ›</span>
                </a>
                <a href="https://www.google.com/maps" target="_blank" class="flex-1 sketch-card p-2 flex items-center justify-center gap-2 hover:opacity-80">
                    <i class="fas fa-map-marked-alt text-blue-600"></i>
                    <span class="text-xs font-bold">Google Maps</span>
                </a>
            </div>

            <!-- Accommodation -->
            <div class="sketch-card p-3 mb-6 flex items-center gap-3">
                <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center border border-black text-black">
                    <i class="fas fa-bed"></i>
                </div>
                <div class="flex-1">
                    <h3 class="font-bold text-sm">Trip & Sleep Hostel</h3>
                    <p class="text-[10px] text-gray-500">å¤§é ˆ/ä¸Šå‰æ´¥å€åŸŸ</p>
                </div>
                <a href="https://www.google.com/maps/search/?api=1&query=Trip+and+Sleep+Hostel+Nagoya" target="_blank" class="text-xs border border-black px-2 py-1 rounded hover:opacity-80">
                    <i class="fas fa-map-marker-alt text-red-500"></i> Map
                </a>
            </div>

            <!-- Day Tabs -->
            <div class="flex gap-2 overflow-x-auto hide-scrollbar mb-4">
                <button id="tab-day1" onclick="switchDay('day1')" class="day-tab active bg-white border-2 border-black px-4 py-2 rounded-lg font-bold text-sm whitespace-nowrap shadow-[2px_2px_0_0_#000] flex flex-col items-center justify-center leading-tight min-w-[100px] text-black">
                    <span class="text-base">Day 1</span><span class="text-xs font-normal mt-0.5">03/03(äºŒ)</span>
                </button>
                <button id="tab-day2" onclick="switchDay('day2')" class="day-tab bg-gray-100 border-2 border-transparent px-4 py-2 rounded-lg font-bold text-sm whitespace-nowrap text-gray-500 flex flex-col items-center justify-center leading-tight min-w-[100px]">
                    <span class="text-base">Day 2</span><span class="text-xs font-normal mt-0.5">03/04(ä¸‰)</span>
                </button>
                <button id="tab-day3" onclick="switchDay('day3')" class="day-tab bg-gray-100 border-2 border-transparent px-4 py-2 rounded-lg font-bold text-sm whitespace-nowrap text-gray-500 flex flex-col items-center justify-center leading-tight min-w-[100px]">
                    <span class="text-base">Day 3</span><span class="text-xs font-normal mt-0.5">03/05(å››)</span>
                </button>
            </div>

            <!-- Day Content Container -->
            <div id="day-content"></div>
        </div>

        <!-- ================= PAGE: GUIDE ================= -->
        <div id="page-guide" class="page-content">
            <h2 class="text-2xl font-black mb-4">æ·±åº¦å°è¦½ Guide</h2>
            <div class="space-y-6">
                <article class="sketch-card p-4">
                    <div class="h-32 bg-gray-200 rounded-lg mb-3 flex items-center justify-center overflow-hidden relative">
                        <div class="text-4xl">ğŸ‹</div>
                        <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
                        <span class="absolute bottom-2 left-3 text-white font-bold">åå¤å±‹åŸ</span>
                    </div>
                    <h3 class="font-bold text-lg mb-2">å°¾å¼µå¾·å·å®¶çš„å±…åŸ</h3>
                    <p class="text-sm text-gray-500 leading-relaxed mb-3">æ—¥æœ¬ä¸‰ååŸä¹‹ä¸€ï¼Œæœ€å¤§ç‰¹è‰²æ˜¯å¤©å®ˆé–£å±‹é ‚ä¸Šçš„å…©éš»é‡‘å…‰é–ƒé–ƒçš„ã€Œé‡‘é¯±ã€ã€‚</p>
                </article>
                <article class="sketch-card p-4">
                    <div class="h-32 bg-gray-200 rounded-lg mb-3 flex items-center justify-center overflow-hidden relative">
                        <div class="text-4xl">ğŸ¯</div>
                        <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
                        <span class="absolute bottom-2 left-3 text-white font-bold">çŠ¬å±±åŸ</span>
                    </div>
                    <h3 class="font-bold text-lg mb-2">ç¾å­˜æœ€å¤è€å¤©å®ˆ</h3>
                    <p class="text-sm text-gray-500 leading-relaxed mb-3">åˆ¥åã€Œç™½å¸åŸã€ï¼Œä½åœ¨æœ¨æ›¾å·ç•”çš„å°å±±ä¸˜ä¸Šï¼Œæ˜¯æ—¥æœ¬åœ‹å¯¶äº”åŸä¹‹ä¸€ã€‚</p>
                </article>
            </div>
        </div>

        <!-- ================= PAGE: WALLET ================= -->
        <div id="page-wallet" class="page-content">
            <h2 class="text-2xl font-black mb-4">è¨˜å¸³ & åŒ¯ç‡ Wallet</h2>

            <!-- Budget Control -->
            <div class="sketch-box p-3 bg-gray-100 mb-4 border-dashed">
                <div class="flex justify-between items-center mb-2">
                    <div class="text-xs font-bold text-gray-500">ç¸½é ç®—è¨­å®š (TWD)</div>
                    <input type="number" id="budget-input" class="bg-transparent border-b border-gray-400 text-right w-24 font-mono text-sm focus:outline-none text-black" placeholder="è¨­å®šé‡‘é¡" onchange="updateBudget()">
                </div>
                <div class="h-2 bg-gray-300 rounded-full overflow-hidden">
                    <div id="budget-bar" class="h-full bg-green-500 w-0 transition-all duration-500"></div>
                </div>
                <div class="flex justify-between mt-1">
                    <span class="text-[10px] text-gray-400">å·²æ”¯å‡º: $<span id="budget-spent">0</span></span>
                    <span class="text-[10px] text-gray-400">å‰©é¤˜: $<span id="budget-left">0</span></span>
                </div>
            </div>

            <!-- Currency Converter -->
            <div class="sketch-card p-4 bg-gray-800 text-white mb-6">
                <h3 class="text-xs font-bold text-gray-400 mb-2 uppercase">Quick Converter (Jpy â†’ Twd)</h3>
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-xl font-bold">Â¥</span>
                    <input type="text" id="calc-input" placeholder="è¼¸å…¥ç®—å¼ (å¦‚ 500*3)" class="w-full bg-transparent border-b border-gray-600 text-2xl font-mono focus:outline-none focus:border-yellow-400 text-white">
                </div>
                <div class="flex justify-between items-end">
                    <div class="text-xs text-gray-400">Rate: <span id="rate-display">0.215</span></div>
                    <div class="text-right"><div class="text-3xl font-black text-yellow-400">NT$ <span id="calc-result">0</span></div></div>
                </div>
            </div>

            <!-- Expense Entry Form -->
            <div class="sketch-box p-4 bg-white mb-6">
                <div class="text-center text-sm font-bold text-gray-600 flex items-center justify-center gap-2 mb-4 bg-yellow-50 p-2 rounded border border-dashed border-yellow-300">
                    <span>ğŸ’¡ å¯ç”¨å°å¹£/æ—¥å¹£åƒ¹æ ¼è¼¸å…¥</span>
                    <svg width="24" height="24" viewBox="0 0 50 50" overflow="visible"><circle cx="25" cy="10" r="5" fill="none" stroke="#4b5563" stroke-width="2"/><line x1="25" y1="15" x2="25" y2="35" stroke="#4b5563" stroke-width="2"/><line x1="25" y1="35" x2="18" y2="45" stroke="#4b5563" stroke-width="2"/><line x1="25" y1="35" x2="32" y2="45" stroke="#4b5563" stroke-width="2"/><line x1="25" y1="20" x2="15" y2="25" stroke="#4b5563" stroke-width="2"/><g class="stickman-arm"><line x1="25" y1="20" x2="35" y2="10" stroke="#4b5563" stroke-width="2"/><rect x="32" y="2" width="14" height="8" fill="#86efac" stroke="#4b5563" stroke-width="1" transform="rotate(-15 32 10)"/><text x="39" y="9" font-size="6" font-weight="bold" fill="#065f46" text-anchor="middle" transform="rotate(-15 32 10)">Â¥</text></g></svg>
                </div>
                
                <div class="space-y-3">
                    <input type="text" id="expense-item" placeholder="å“é …åç¨± (å¦‚: æ™šé¤)" class="sketch-input w-full p-2">
                    
                    <div class="flex gap-2 items-center">
                        <div class="relative w-12 h-12 flex-shrink-0">
                            <div class="absolute inset-0 border-2 border-black rounded-lg flex items-center justify-center bg-white pointer-events-none z-10 shadow-[2px_2px_0_0_#ccc]"><i id="category-icon" class="fas fa-utensils text-lg text-black"></i></div>
                            <select id="expense-category" onchange="updateCategoryIcon(this)" class="w-full h-full opacity-0 absolute inset-0 z-20 cursor-pointer"><option value="food">é£²é£Ÿ</option><option value="shopping">è³¼ç‰©</option><option value="transport">äº¤é€š</option><option value="accommodation">ä½å®¿</option><option value="other">å…¶ä»–</option></select>
                        </div>
                        <div class="relative w-12 h-12 flex-shrink-0">
                            <div class="absolute inset-0 border-2 border-black rounded-lg flex items-center justify-center bg-white pointer-events-none z-10 shadow-[2px_2px_0_0_#ccc]"><span id="currency-symbol" class="font-black text-lg text-black">Â¥</span></div>
                            <select id="expense-currency" onchange="updateCurrencySymbol(this)" class="w-full h-full opacity-0 absolute inset-0 z-20 cursor-pointer"><option value="JPY">JPY</option><option value="TWD">TWD</option></select>
                        </div>
                        <input type="number" id="expense-amount" placeholder="é‡‘é¡" class="sketch-input flex-1 h-12 p-2 font-mono text-lg">
                    </div>
                    
                    <div class="flex gap-2">
                        <label class="flex-1 flex items-center justify-center gap-2 border-2 border-dashed border-gray-300 rounded-lg p-2 cursor-pointer hover:opacity-80 transition">
                            <i class="fas fa-camera text-gray-400"></i><span class="text-xs text-gray-500" id="photo-label">ç…§ç‰‡</span>
                            <input type="file" id="expense-photo" accept="image/*" class="hidden" onchange="handlePhotoUpload(this)">
                        </label>
                        <label class="flex-1 flex items-center justify-center gap-2 border-2 border-gray-300 rounded-lg p-2 cursor-pointer bg-gray-50 has-[:checked]:bg-green-50 has-[:checked]:border-green-500 transition">
                            <input type="checkbox" id="expense-shared" class="accent-green-500">
                            <span class="text-xs font-bold text-gray-600">å…¬è²» (Shared)</span>
                        </label>
                    </div>
                    <input type="hidden" id="expense-photo-base64">
                    <button onclick="addExpense()" class="w-full bg-black text-white font-bold py-2 rounded-lg hover:bg-gray-800 transition shadow-[2px_2px_0_0_#ccc]">è¨˜ä¸€ç­†</button>
                </div>
            </div>

            <div id="expenses-container" class="space-y-6 pb-20"></div>
            
            <div class="fixed bottom-[70px] left-0 right-0 bg-gray-900 text-white p-4 mx-4 rounded-xl shadow-2xl z-50 border-2 border-white max-w-[448px] md:mx-auto">
                <div class="flex justify-between items-center">
                    <div><div class="text-[10px] text-gray-400 uppercase tracking-widest">Total Expenses</div><div class="text-2xl font-black text-yellow-400">Â¥ <span id="total-jpy">0</span></div></div>
                    <div class="text-right"><div class="text-[10px] text-gray-400">Approx. TWD</div><div class="text-lg font-bold">NT$ <span id="total-twd">0</span></div></div>
                </div>
            </div>
        </div>

        <!-- ================= PAGE: LISTS ================= -->
        <div id="page-lists" class="page-content">
            <h2 class="text-2xl font-black mb-4">æ¸…å–® Lists</h2>
            <div class="sketch-card p-4 mb-6 bg-yellow-50">
                <h3 class="font-bold mb-3 border-b-2 border-black pb-1 text-black"><i class="fas fa-check-square mr-2"></i>è¡Œå‰æº–å‚™</h3>
                <div id="checklist-container" class="space-y-2"></div>
                <div class="mt-3 flex gap-2">
                    <input type="text" id="new-check-item" placeholder="æ–°å¢é …ç›®..." class="sketch-input flex-1 p-1 text-sm">
                    <button onclick="addCheckItem()" class="bg-black text-white w-8 rounded"><i class="fas fa-plus"></i></button>
                </div>
            </div>
            <div class="sketch-card p-4 bg-white">
                <h3 class="font-bold mb-3 border-b-2 border-black pb-1"><i class="fas fa-sticky-note mr-2"></i>å€‹äººå‚™å¿˜éŒ„</h3>
                <textarea id="memo-area" class="w-full h-40 p-2 text-sm border border-gray-200 rounded resize-none focus:outline-none bg-white text-black" placeholder="è¼¸å…¥å‚™å¿˜..."></textarea>
                <div id="memo-links" class="mt-2 flex flex-wrap gap-2"></div>
            </div>
        </div>

        <!-- ================= PAGE: INFO ================= -->
        <div id="page-info" class="page-content">
            <h2 class="text-2xl font-black mb-4">å¯¦ç”¨è³‡è¨Š Info</h2>

            <!-- Weather -->
            <div class="sketch-card p-4 mb-6 bg-gradient-to-br from-blue-100 to-white relative overflow-hidden">
                <h3 class="font-bold mb-2">åå¤å±‹å¤©æ°£</h3>
                <div id="weather-widget" class="flex items-center justify-between">
                    <div><div class="text-3xl font-black" id="temp-display">--Â°C</div><div class="text-sm text-gray-600" id="weather-desc">Loading...</div></div>
                    <div class="text-4xl opacity-50"><i class="fas fa-cloud-sun"></i></div>
                </div>
            </div>

            <!-- Translation Cards -->
            <div class="grid grid-cols-2 gap-3 mb-6">
                <button onclick="showTranslation('è”¥', 'ãƒã‚®æŠœãã§ãŠé¡˜ã„ã—ã¾ã™', 'è«‹ä¸è¦åŠ è”¥')" class="sketch-card p-3 hover:bg-gray-50 text-center">
                    <div class="text-2xl">ğŸ§…</div><div class="text-xs font-bold">ä¸è¦è”¥</div>
                </button>
                <button onclick="showTranslation('å†°', 'æ°·ãªã—ã§ãŠé¡˜ã„ã—ã¾ã™', 'è«‹å»å†°')" class="sketch-card p-3 hover:bg-gray-50 text-center">
                    <div class="text-2xl">ğŸ§Š</div><div class="text-xs font-bold">å»å†°</div>
                </button>
                <button onclick="showTranslation('æ°´', 'ãŠæ°´ãã ã•ã„', 'è«‹çµ¦æˆ‘æ°´')" class="sketch-card p-3 hover:bg-gray-50 text-center">
                    <div class="text-2xl">ğŸ’§</div><div class="text-xs font-bold">è«‹çµ¦æ°´</div>
                </button>
                <button onclick="showTranslation('å»æ‰€', 'ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹ï¼Ÿ', 'å»æ‰€åœ¨å“ªè£¡')" class="sketch-card p-3 hover:bg-gray-50 text-center">
                    <div class="text-2xl">ğŸš»</div><div class="text-xs font-bold">å»æ‰€</div>
                </button>
            </div>

            <!-- Size Chart -->
            <button onclick="toggleModal('modal-size')" class="w-full sketch-card p-3 mb-6 flex items-center justify-between hover:opacity-80">
                <span class="font-bold"><i class="fas fa-ruler-combined mr-2 text-purple-500"></i>å°ºç¢¼å°ç…§è¡¨</span>
                <i class="fas fa-chevron-right text-gray-400"></i>
            </button>

            <!-- Data Backup -->
            <div class="sketch-card p-4 mb-6 bg-gray-50">
                <h3 class="font-bold mb-3 text-sm text-gray-700"><i class="fas fa-database mr-2"></i>è³‡æ–™å‚™ä»½ & åˆ†äº«</h3>
                <div class="flex gap-2 mb-3">
                    <button onclick="exportData()" class="flex-1 bg-white border border-black rounded p-2 text-xs font-bold hover:bg-gray-100 text-black">åŒ¯å‡º (è¤‡è£½ä»£ç¢¼)</button>
                    <button onclick="importData()" class="flex-1 bg-black text-white border border-black rounded p-2 text-xs font-bold hover:bg-gray-800">åŒ¯å…¥ (è²¼ä¸Šä»£ç¢¼)</button>
                </div>
                <div class="flex gap-2">
                    <button onclick="exportCSV()" class="flex-1 bg-green-100 border border-black rounded p-2 text-xs font-bold hover:bg-green-200 text-green-800">åŒ¯å‡º Excel (CSV)</button>
                    <button onclick="toggleModal('modal-qr')" class="flex-1 bg-blue-100 border border-black rounded p-2 text-xs font-bold hover:bg-blue-200 text-blue-800">é¡¯ç¤º QR Code</button>
                </div>
            </div>
            
            <!-- Emergency -->
            <div class="sketch-card p-4 mb-6 bg-red-50 border-2 border-red-100">
                <h3 class="font-bold mb-3 text-red-600 border-b border-red-200 pb-1"><i class="fas fa-ambulance mr-2"></i>ç·Šæ€¥è¯çµ¡</h3>
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <a href="tel:110" class="bg-white p-3 rounded-lg border border-red-100 shadow-sm flex flex-col items-center justify-center hover:bg-red-50 transition"><i class="fas fa-user-shield text-xl text-blue-800 mb-1"></i><span class="text-xs font-bold text-gray-600">è­¦å¯Ÿ (110)</span></a>
                    <a href="tel:119" class="bg-white p-3 rounded-lg border border-red-100 shadow-sm flex flex-col items-center justify-center hover:bg-red-50 transition"><i class="fas fa-ambulance text-xl text-red-500 mb-1"></i><span class="text-xs font-bold text-gray-600">æ•‘è­· (119)</span></a>
                </div>
                <div class="border-t border-dashed border-red-200 pt-3">
                    <h4 class="font-bold text-sm mb-2 text-gray-700">æœ€è¿‘çš„æ±‚æ•‘åœ°é»</h4>
                    <button onclick="findNearestHelp()" id="btn-find-help" class="w-full bg-red-500 text-white font-bold py-2 rounded-lg hover:bg-red-600 transition flex items-center justify-center gap-2 shadow text-sm"><i class="fas fa-location-arrow"></i> å®šä½ä¸¦æœå°‹</button>
                    <div id="help-result" class="hidden mt-3 bg-white p-3 rounded-lg border border-gray-200">
                        <div class="flex items-start gap-3">
                            <div class="text-2xl text-red-500"><i class="fas fa-map-marker-alt"></i></div>
                            <div class="flex-1"><div id="help-name" class="font-bold text-sm text-gray-800">æœå°‹ä¸­...</div><div id="help-dist" class="text-xs text-gray-500 mt-1"></div><a id="help-link" href="#" target="_blank" class="hidden mt-2 inline-block text-[10px] bg-gray-100 px-2 py-1 rounded text-blue-600 font-bold">é–‹å•Ÿ Google Maps å°èˆª</a></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tips -->
            <div class="sketch-card p-4 bg-white">
                <h3 class="font-bold mb-2 text-red-500"><i class="fas fa-exclamation-triangle mr-2"></i>æ³¨æ„äº‹é …</h3>
                <div class="mb-4 pb-3 border-b border-dashed border-gray-200">
                    <h4 class="font-bold text-sm mb-1 text-gray-800"><i class="fas fa-tshirt mr-1"></i>ç•¶æ—¥å»ºè­°ç©¿è‘— (3æœˆåˆ)</h4>
                    <p class="text-xs text-gray-600 leading-relaxed">
                        æ°£æº«ç´„ 5Â°C ~ 15Â°Cï¼Œæ—©æ™šæº«å·®å¤§ã€‚å»ºè­°æ¡ç”¨<strong>æ´‹è”¥å¼ç©¿æ­</strong>ï¼š
                        <br>ğŸ§¥ <strong>å¤–å¥—</strong>ï¼šé˜²é¢¨å¤§è¡£æˆ–è¼•ç¾½çµ¨ (æ—©æ™šå†·)ã€‚
                        <br>ğŸ‘• <strong>ä¸Šè¡£</strong>ï¼šç™¼ç†±è¡£ + é‡ç¹”è¡«/è¡›è¡£ã€‚
                        <br>ğŸ§£ <strong>é…ä»¶</strong>ï¼šåœå·¾ (é¢¨å¤§æ™‚å¥½ç”¨)ã€‚
                        <br>ğŸ‘Ÿ <strong>é‹å­</strong>ï¼šå¥½èµ°çš„çƒé‹ (è¡Œç¨‹å¤šèµ°è·¯)ã€‚
                    </p>
                </div>
                <ul class="text-sm list-disc pl-4 space-y-1 text-gray-600">
                    <li>æ—¥æœ¬é›»å£“ç‚º 100Vï¼Œæ’åº§ç‚ºé›™å¹³è…³ã€‚</li>
                    <li>è·¯ä¸Šç¦æ­¢å¸è¸ï¼Œè«‹è‡³æŒ‡å®šå¸è¸å€ã€‚</li>
                    <li>é›»è»Šå…§è«‹å°‡æ‰‹æ©Ÿè¨­ç‚ºéœéŸ³ï¼Œé¿å…é€šè©±ã€‚</li>
                    <li>çµå¸³æ™‚è«‹å°‡éŒ¢æ”¾åœ¨æ«ƒæª¯çš„å°ç›¤å­ä¸Šã€‚</li>
                </ul>
            </div>
        </div>

        <!-- MODALS -->
        <div id="modal-size" class="modal-overlay" onclick="if(event.target===this) toggleModal('modal-size')">
            <div class="modal-content">
                <h3 class="font-bold text-lg mb-4 border-b-2 border-black pb-2">å°ºç¢¼å°ç…§è¡¨ (JP)</h3>
                <div class="space-y-4 text-sm">
                    <div><h4 class="font-bold bg-gray-100 p-1 mb-1 text-black">ğŸ‘Ÿ é‹ç¢¼ (å¥³)</h4><div class="grid grid-cols-3 gap-2 text-center"><div class="border p-1">JP</div><div class="border p-1">US</div><div class="border p-1">EU</div><div>23</div><div>6</div><div>36</div><div>23.5</div><div>6.5</div><div>37</div><div>24</div><div>7</div><div>38</div><div>24.5</div><div>7.5</div><div>39</div></div></div>
                    <div><h4 class="font-bold bg-gray-100 p-1 mb-1 text-black">ğŸ‘Ÿ é‹ç¢¼ (ç”·)</h4><div class="grid grid-cols-3 gap-2 text-center"><div class="border p-1">JP</div><div class="border p-1">US</div><div class="border p-1">EU</div><div>26</div><div>8</div><div>41</div><div>27</div><div>9</div><div>42.5</div><div>28</div><div>10</div><div>44</div></div></div>
                </div>
                <button onclick="toggleModal('modal-size')" class="mt-4 w-full bg-black text-white p-2 rounded font-bold">é—œé–‰</button>
            </div>
        </div>

        <!-- MODAL: Translation Card -->
        <div id="modal-trans" class="modal-overlay" onclick="if(event.target===this) toggleModal('modal-trans')">
            <div class="modal-content flex flex-col items-center justify-center text-center" style="min-height: 300px;">
                <div class="text-6xl mb-4" id="trans-icon">ğŸ—£ï¸</div>
                <h2 class="text-2xl font-black mb-2" id="trans-jp">ã“ã‚“ã«ã¡ã¯</h2>
                <p class="text-lg text-gray-500 mb-6" id="trans-zh">ä½ å¥½</p>
                <p class="text-xs text-gray-400">è«‹å‡ºç¤ºæ­¤ç•«é¢çµ¦åº—å“¡çœ‹</p>
                <button onclick="toggleModal('modal-trans')" class="mt-auto w-full bg-black text-white p-3 rounded font-bold">é—œé–‰</button>
            </div>
        </div>

        <!-- MODAL: QR Code -->
        <div id="modal-qr" class="modal-overlay" onclick="if(event.target===this) toggleModal('modal-qr')">
            <div class="modal-content flex flex-col items-center">
                <h3 class="font-bold text-lg mb-4">æƒæåˆ†äº«è³‡æ–™</h3>
                <div id="qrcode" class="bg-white p-2"></div>
                <p class="text-xs text-gray-500 mt-2">è«‹æ—…ä¼´ä½¿ç”¨ç›¸æ©Ÿæƒæ</p>
                <button onclick="toggleModal('modal-qr')" class="mt-4 w-full bg-black text-white p-2 rounded font-bold">é—œé–‰</button>
            </div>
        </div>

        <!-- BOTTOM NAV -->
        <nav class="bottom-nav">
            <button onclick="switchPage('page-plan')" id="nav-plan" class="nav-item active"><i class="fas fa-map-marked-alt"></i><span class="mt-1">PLAN</span></button>
            <button onclick="switchPage('page-guide')" id="nav-guide" class="nav-item"><i class="fas fa-book-open"></i><span class="mt-1">GUIDE</span></button>
            <button onclick="switchPage('page-wallet')" id="nav-wallet" class="nav-item"><i class="fas fa-wallet"></i><span class="mt-1">WALLET</span></button>
            <button onclick="switchPage('page-lists')" id="nav-lists" class="nav-item"><i class="fas fa-list-check"></i><span class="mt-1">LISTS</span></button>
            <button onclick="switchPage('page-info')" id="nav-info" class="nav-item"><i class="fas fa-info-circle"></i><span class="mt-1">INFO</span></button>
        </nav>
    </div>

    <script>
        // ================= DATA & STATE =================
        let exchangeRate = 0.215;
        const expenseCategories = [
            { id: 'food', name: 'é£²é£Ÿ', icon: 'fa-utensils', color: 'bg-orange-50', chartColor: '#fdba74' },
            { id: 'shopping', name: 'è³¼ç‰©', icon: 'fa-shopping-bag', color: 'bg-pink-50', chartColor: '#f9a8d4' },
            { id: 'transport', name: 'äº¤é€š', icon: 'fa-train', color: 'bg-blue-50', chartColor: '#93c5fd' },
            { id: 'accommodation', name: 'ä½å®¿', icon: 'fa-bed', color: 'bg-purple-50', chartColor: '#d8b4fe' },
            { id: 'other', name: 'å…¶ä»–', icon: 'fa-ellipsis-h', color: 'bg-gray-100', chartColor: '#d1d5db' }
        ];
        const defaultChecklist = [
            { text: "è­·ç…§", checked: false }, { text: "ç¶²å¡ / Roaming", checked: false }, { text: "æ—¥å¹£ç¾é‡‘", checked: false }, { text: "è¡Œå‹•é›»æº", checked: false }
        ];
        const emergencySpots = [
            { name: "æ„›çŸ¥ç¸£ä¸­è­¦å¯Ÿç½²", lat: 35.1627, lng: 136.9095 }, { name: "å‚ç¨®ç—…é™¢ (æ€¥æ•‘)", lat: 35.1539, lng: 136.8920 }
        ];

        // ================= MAIN LOGIC =================
        window.onload = function() {
            // Load saved theme
            if (localStorage.getItem('theme') === 'dark') toggleTheme(false);
            
            switchDay('day1');
            renderExpenses();
            renderChecklist();
            parseMemoLinks(document.getElementById('memo-area').value);
            fetchWeather();
            updateCountdown();
            setInterval(updateCountdown, 1000);
            
            // Check Smart Status
            updateSmartStatus();
        };

        // Theme Toggle
        function toggleTheme(save = true) {
            const body = document.body;
            const icon = document.getElementById('theme-icon');
            if (body.getAttribute('data-theme') === 'dark') {
                body.removeAttribute('data-theme');
                icon.className = 'fas fa-moon';
                if(save) localStorage.setItem('theme', 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                icon.className = 'fas fa-sun';
                if(save) localStorage.setItem('theme', 'dark');
            }
        }

        function switchPage(pageId) {
            document.querySelectorAll('.page-content').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            window.scrollTo(0,0);
            document.querySelectorAll('.nav-item').forEach(btn => btn.classList.remove('active'));
            document.getElementById(pageId.replace('page-', 'nav-')).classList.add('active');
            const iconMap = { 'page-plan': 'fa-plane', 'page-guide': 'fa-book-open', 'page-wallet': 'fa-coins', 'page-lists': 'fa-list-check', 'page-info': 'fa-info' };
            const headerIcon = document.querySelector('#page-title-icon i');
            if (headerIcon) headerIcon.className = `fas ${iconMap[pageId]}`;
        }

        // Simplified Day Switcher with Maps injected
        function switchDay(dayId) {
            document.querySelectorAll('.day-tab').forEach(btn => {
                const isActive = btn.id === 'tab-' + dayId;
                btn.className = isActive 
                    ? 'day-tab active bg-white border-2 border-black px-4 py-2 rounded-lg font-bold text-sm whitespace-nowrap shadow-[2px_2px_0_0_#000] flex flex-col items-center justify-center leading-tight min-w-[100px] text-black'
                    : 'day-tab bg-gray-100 border-2 border-transparent px-4 py-2 rounded-lg font-bold text-sm whitespace-nowrap text-gray-500 flex flex-col items-center justify-center leading-tight min-w-[100px]';
            });

            const contentDiv = document.getElementById('day-content');
            let html = '';
            
            // SVG Path Data for each day (Simplified for brevity but functional)
            if (dayId === 'day1') {
                html = `<div id="day1-detail" class="day-detail"><h3 class="font-black text-xl mb-4 border-l-4 border-blue-400 pl-3">å¸‚å€ç¾é£Ÿå·¡ç¦®</h3><div class="relative pl-2"><div class="timeline-line"></div>
                <div class="relative flex items-start mb-6" id="card-d1-1"><div class="bg-white border-2 border-black w-8 h-8 rounded-full flex items-center justify-center z-10 mr-3 flex-shrink-0"><span class="font-bold text-xs">08:00</span></div><div class="sketch-card p-3 flex-1 relative"><div class="absolute top-2 right-2 text-gray-300 cursor-pointer" onclick="editNote('card-d1-1')"><i class="fas fa-edit"></i></div><h4 class="font-bold">å‡ºç™¼ï¼</h4><p class="text-xs text-gray-500">Hostel é›†åˆ</p><div class="note-area mt-2 text-xs text-blue-600 font-bold hidden"></div></div></div>
                <div class="relative flex items-start mb-6"><div class="timeline-travel">ğŸšƒ ç§»å‹•ç´„ 15åˆ†</div></div>
                <div class="relative flex items-start mb-6" id="card-d1-2"><div class="bg-white border-2 border-black w-8 h-8 rounded-full flex items-center justify-center z-10 mr-3 flex-shrink-0"><span class="font-bold text-xs">08:30</span></div><div class="sketch-box p-3 bg-blue-50 flex-1 border-dashed relative"><div class="absolute top-2 right-2 text-gray-400 cursor-pointer" onclick="editNote('card-d1-2')"><i class="fas fa-edit"></i></div><h4 class="font-bold">æŸ³æ©‹ä¸­å¤®å¸‚å ´</h4><p class="text-xs">ç”Ÿé­šç‰‡ã€æµ·é®®å·¡ç¦®</p><a href="https://www.google.com/maps/search/?api=1&query=Yanagibashi+Central+Market" target="_blank" class="inline-block text-[10px] bg-white px-2 py-1 rounded border border-gray-300 mt-2 hover:opacity-80 text-gray-600"><i class="fas fa-map-marker-alt text-red-500 mr-1"></i>é–‹å•Ÿ Google Maps</a><div class="note-area mt-2 text-xs text-blue-600 font-bold hidden"></div></div></div>
                <div class="relative flex items-start mb-6"><div class="timeline-travel">ğŸšƒ ç§»å‹•ç´„ 15åˆ†</div></div>
                <div class="relative flex items-start mb-6" id="card-d1-3"><div class="bg-orange-100 border-2 border-black w-8 h-8 rounded-full flex items-center justify-center z-10 mr-3 flex-shrink-0"><i class="fas fa-utensils text-xs"></i></div><div class="sketch-card p-3 flex-1 relative"><div class="absolute top-2 right-2 text-gray-300 cursor-pointer" onclick="editNote('card-d1-3')"><i class="fas fa-edit"></i></div><span class="text-[10px] font-bold bg-gray-100 px-1.5 py-0.5 rounded text-gray-600 mb-1 inline-block"><i class="far fa-clock mr-1"></i>10:00</span><h4 class="font-bold">Konparu (æ¦®)</h4><p class="text-xs text-gray-500">ç‚¸è¦ä¸‰æ˜æ²»æ—©é¤</p><a href="https://www.google.com/maps/search/?api=1&query=Konparu+Sakae" target="_blank" class="inline-block text-[10px] bg-white px-2 py-1 rounded border border-gray-300 mt-2 hover:opacity-80 text-gray-600"><i class="fas fa-map-marker-alt text-red-500 mr-1"></i>é–‹å•Ÿ Google Maps</a><div class="note-area mt-2 text-xs text-blue-600 font-bold hidden"></div></div></div>
                <div class="relative flex items-start mb-6"><div class="timeline-travel">ğŸšƒ ç§»å‹•ç´„ 15åˆ†</div></div>
                <div class="relative flex items-start mb-6" id="card-d1-4"><div class="bg-yellow-100 border-2 border-black w-8 h-8 rounded-full flex items-center justify-center z-10 mr-3 flex-shrink-0"><i class="fas fa-utensils text-xs"></i></div><div class="sketch-card p-3 flex-1 relative"><div class="absolute top-2 right-2 text-gray-300 cursor-pointer" onclick="editNote('card-d1-4')"><i class="fas fa-edit"></i></div><span class="text-[10px] font-bold bg-gray-100 px-1.5 py-0.5 rounded text-gray-600 mb-1 inline-block"><i class="far fa-clock mr-1"></i>12:00</span><h4 class="font-bold">é³¥é–‹ç·æœ¬å®¶</h4><p class="text-xs text-gray-500">é‡‘è³è¦ªå­ä¸¼</p><a href="https://www.google.com/maps/search/?api=1&query=Torikai+Sohonke+Lucent+Tower" target="_blank" class="inline-block text-[10px] bg-white px-2 py-1 rounded border border-gray-300 mt-2 hover:bg-gray-50 text-gray-600"><i class="fas fa-map-marker-alt text-red-500 mr-1"></i>é–‹å•Ÿ Google Maps</a><div class="note-area mt-2 text-xs text-blue-600 font-bold hidden"></div></div></div>
                <div class="relative flex items-start mb-6"><div class="timeline-travel">ğŸšƒ ç§»å‹•ç´„ 20åˆ†</div></div>
                <div class="relative flex items-start mb-6" id="card-d1-5"><div class="bg-red-100 border-2 border-black w-8 h-8 rounded-full flex items-center justify-center z-10 mr-3 flex-shrink-0"><i class="fas fa-shopping-bag text-xs"></i></div><div class="sketch-card p-3 flex-1 relative"><div class="absolute top-2 right-2 text-gray-300 cursor-pointer" onclick="editNote('card-d1-5')"><i class="fas fa-edit"></i></div><span class="text-[10px] font-bold bg-gray-100 px-1.5 py-0.5 rounded text-gray-600 mb-1 inline-block"><i class="far fa-clock mr-1"></i>14:00</span><h4 class="font-bold">å¤§é ˆå•†åº—è¡—</h4><p class="text-xs text-gray-500">é€›è¡—ã€ä¸‹åˆèŒ¶</p><a href="https://www.google.com/maps/search/?api=1&query=Osu+Shopping+District" target="_blank" class="inline-block text-[10px] bg-white px-2 py-1 rounded border border-gray-300 mt-2 hover:bg-gray-50 text-gray-600"><i class="fas fa-map-marker-alt text-red-500 mr-1"></i>é–‹å•Ÿ Google Maps</a><div class="note-area mt-2 text-xs text-blue-600 font-bold hidden"></div></div></div>
                <div class="relative flex items-start mb-6"><div class="timeline-travel">ğŸšƒ ç§»å‹•ç´„ 20åˆ†</div></div>
                <div class="relative flex items-start mb-6" id="card-d1-6"><div class="bg-yellow-100 border-2 border-black w-8 h-8 rounded-full flex items-center justify-center z-10 mr-3 flex-shrink-0"><i class="fas fa-drumstick-bite text-xs"></i></div><div class="sketch-card p-3 flex-1 border-l-4 border-black relative"><div class="absolute top-2 right-2 text-gray-300 cursor-pointer" onclick="editNote('card-d1-6')"><i class="fas fa-edit"></i></div><span class="text-[10px] font-bold bg-gray-100 px-1.5 py-0.5 rounded text-gray-600 mb-1 inline-block"><i class="far fa-clock mr-1"></i>17:30</span><h4 class="font-bold">ç†±ç”°è“¬èŠè»’ (æ™šé¤)</h4><p class="text-xs text-gray-500">å¿…åƒé°»é­šé£¯ä¸‰åƒ Hitsumabushi</p><a href="https://www.google.com/maps/search/?api=1&query=Atsuta+Houraiken+Matsuzakaya" target="_blank" class="inline-block text-[10px] bg-white px-2 py-1 rounded border border-gray-300 mt-2 hover:bg-gray-50 text-gray-600"><i class="fas fa-map-marker-alt text-red-500 mr-1"></i>é–‹å•Ÿ Google Maps</a><div class="note-area mt-2 text-xs text-blue-600 font-bold hidden"></div></div></div>
                </div>
                <div class="map-container"><h4 class="absolute top-2 left-3 font-bold text-[10px] bg-white px-2 py-1 border border-black rounded z-10">Day 1 Route</h4><svg viewBox="0 0 350 400" class="w-full h-full"><path d="M 120 0 Q 110 200 130 400" fill="none" stroke="#e0f2fe" stroke-width="20"/><line x1="0" y1="200" x2="350" y2="200" stroke="#e5e5e5" stroke-width="12"/><line x1="230" y1="0" x2="230" y2="400" stroke="#e5e5e5" stroke-width="12"/><path d="M 210 210 Q 250 250 240 300" fill="none" stroke="#38bdf8" stroke-width="4" stroke-dasharray="10,5" class="path-line" marker-end="url(#arrow-blue)" /><path d="M 240 300 Q 250 150 240 80" fill="none" stroke="#38bdf8" stroke-width="4" stroke-dasharray="10,5" class="path-line" marker-end="url(#arrow-blue)" /><path d="M 240 80 Q 150 50 60 80" fill="none" stroke="#38bdf8" stroke-width="4" stroke-dasharray="10,5" class="path-line" marker-end="url(#arrow-blue)" /><path d="M 60 80 Q 80 150 120 200" fill="none" stroke="#38bdf8" stroke-width="4" stroke-dasharray="10,5" class="path-line" marker-end="url(#arrow-blue)" /><path d="M 120 200 Q 150 300 180 350" fill="none" stroke="#38bdf8" stroke-width="4" stroke-dasharray="10,5" class="path-line" marker-end="url(#arrow-blue)" /><path d="M 180 350 Q 220 300 210 210" fill="none" stroke="#38bdf8" stroke-width="4" stroke-dasharray="10,5" class="path-line" marker-end="url(#arrow-blue)" /><text x="240" y="300" font-size="10" font-weight="bold" class="station-label">æŸ³æ©‹</text><text x="240" y="95" font-size="10" font-weight="bold" class="station-label">æ¦®</text><text x="60" y="95" font-size="10" font-weight="bold" class="station-label">åç«™</text><text x="120" y="220" font-size="10" font-weight="bold" class="station-label">å¤§é ˆ</text><text x="180" y="370" font-size="10" font-weight="bold" class="station-label">ç†±ç”°</text><g transform="translate(210, 210)"><path d="M 0 15 L 15 0 L 30 15 L 30 30 L 0 30 Z" fill="white" stroke="#1a1a1a" stroke-width="2"/></g></svg></div></div>`;
            } else if (dayId === 'day2') {
                html = `<div id="day2-detail" class="day-detail"><h3 class="font-black text-xl mb-4 border-l-4 border-pink-400 pl-3">çŠ¬å±±åŸå¤éƒ½éŠ</h3><div class="relative pl-2"><div class="timeline-line"></div>
                <div class="relative flex items-start mb-6" id="card-d2-1"><div class="bg-white border-2 border-black w-8 h-8 rounded-full flex items-center justify-center z-10 mr-3 flex-shrink-0"><span class="font-bold text-xs">07:30</span></div><div class="sketch-card p-3 flex-1 relative"><div class="absolute top-2 right-2 text-gray-300 cursor-pointer" onclick="editNote('card-d2-1')"><i class="fas fa-edit"></i></div><h4 class="font-bold">å‡ºç™¼ï¼</h4><p class="text-xs text-gray-500">Hostel é›†åˆ</p><div class="note-area mt-2 text-xs text-blue-600 font-bold hidden"></div></div></div>
                <div class="relative flex items-start mb-6"><div class="timeline-travel">ğŸšƒ ç§»å‹•ç´„ 15åˆ†</div></div>
                <div class="relative flex items-start mb-6" id="card-d2-2"><div class="bg-white border-2 border-black w-8 h-8 rounded-full flex items-center justify-center z-10 mr-3 flex-shrink-0"><span class="font-bold text-xs">08:00</span></div><div class="sketch-card p-3 flex-1 relative"><div class="absolute top-2 right-2 text-gray-300 cursor-pointer" onclick="editNote('card-d2-2')"><i class="fas fa-edit"></i></div><h4 class="font-bold">Bucyo Coffee</h4><p class="text-xs text-gray-500">å°å€‰ç´…è±†åå¸</p><a href="https://www.google.com/maps/search/?api=1&query=Bucyo+Coffee+KAKO" target="_blank" class="inline-block text-[10px] bg-white px-2 py-1 rounded border border-gray-300 mt-2 hover:bg-gray-50 text-gray-600"><i class="fas fa-map-marker-alt text-red-500 mr-1"></i>é–‹å•Ÿ Google Maps</a><div class="note-area mt-2 text-xs text-blue-600 font-bold hidden"></div></div></div>
                <div class="relative flex items-start mb-6"><div class="timeline-travel">ğŸšƒ ç§»å‹•ç´„ 45åˆ†</div></div>
                <div class="relative flex items-start mb-6" id="card-d2-3"><div class="bg-pink-100 border-2 border-black w-8 h-8 rounded-full flex items-center justify-center z-10 mr-3 flex-shrink-0"><i class="fas fa-chess-rook text-xs"></i></div><div class="sketch-card p-3 flex-1 relative"><div class="absolute top-2 right-2 text-gray-300 cursor-pointer" onclick="editNote('card-d2-3')"><i class="fas fa-edit"></i></div><span class="text-[10px] font-bold bg-gray-100 px-1.5 py-0.5 rounded text-gray-600 mb-1 inline-block"><i class="far fa-clock mr-1"></i>10:00</span><h4 class="font-bold">çŠ¬å±±åŸ</h4><p class="text-xs text-gray-500">åœ‹å¯¶å¤©å®ˆé–£ã€åŸä¸‹ç”ºæ•£ç­–</p><div class="text-[10px] text-blue-600 font-bold mt-1"><i class="fas fa-ticket-alt mr-1"></i>é–€ç¥¨: Â¥550</div><a href="https://www.google.com/maps/search/?api=1&query=Inuyama+Castle" target="_blank" class="inline-block text-[10px] bg-white px-2 py-1 rounded border border-gray-300 mt-2 hover:bg-gray-50 text-gray-600"><i class="fas fa-map-marker-alt text-red-500 mr-1"></i>é–‹å•Ÿ Google Maps</a><div class="note-area mt-2 text-xs text-blue-600 font-bold hidden"></div></div></div>
                <div class="relative flex items-start mb-6" id="card-d2-4"><div class="bg-white border-2 border-black w-8 h-8 rounded-full flex items-center justify-center z-10 mr-3 flex-shrink-0"><span class="font-bold text-xs">12:00</span></div><div class="sketch-card p-3 flex-1 relative"><div class="absolute top-2 right-2 text-gray-300 cursor-pointer" onclick="editNote('card-d2-4')"><i class="fas fa-edit"></i></div><h4 class="font-bold">Sakura Chaya</h4><p class="text-xs text-gray-500">ç”°æ¨‚çƒ¤è±†è…ä¸²</p><a href="https://www.google.com/maps/search/?api=1&query=Sakura+Chaya+Inuyama" target="_blank" class="inline-block text-[10px] bg-white px-2 py-1 rounded border border-gray-300 mt-2 hover:bg-gray-50 text-gray-600"><i class="fas fa-map-marker-alt text-red-500 mr-1"></i>é–‹å•Ÿ Google Maps</a><div class="note-area mt-2 text-xs text-blue-600 font-bold hidden"></div></div></div>
                <div class="relative flex items-start mb-6" id="card-d2-5"><div class="bg-pink-100 border-2 border-black w-8 h-8 rounded-full flex items-center justify-center z-10 mr-3 flex-shrink-0"><i class="fas fa-camera text-xs"></i></div><div class="sketch-card p-3 flex-1 relative"><div class="absolute top-2 right-2 text-gray-300 cursor-pointer" onclick="editNote('card-d2-5')"><i class="fas fa-edit"></i></div><span class="text-[10px] font-bold bg-gray-100 px-1.5 py-0.5 rounded text-gray-600 mb-1 inline-block"><i class="far fa-clock mr-1"></i>13:30</span><h4 class="font-bold">åŸä¸‹ç”ºæ•£ç­–</h4><p class="text-xs text-gray-500">æˆ€æ„›ç¥ç¤¾ã€é£›é©’ç‰›å£½å¸</p><a href="https://www.google.com/maps/search/?api=1&query=Inuyama+Castle+Town" target="_blank" class="inline-block text-[10px] bg-white px-2 py-1 rounded border border-gray-300 mt-2 hover:bg-gray-50 text-gray-600"><i class="fas fa-map-marker-alt text-red-500 mr-1"></i>é–‹å•Ÿ Google Maps</a><div class="note-area mt-2 text-xs text-blue-600 font-bold hidden"></div></div></div>
                <div class="relative flex items-start mb-6"><div class="timeline-travel">ğŸšƒ ç§»å‹•ç´„ 1æ™‚15åˆ†</div></div>
                <div class="relative flex items-start mb-6" id="card-d2-6"><div class="bg-amber-100 border-2 border-black w-8 h-8 rounded-full flex items-center justify-center z-10 mr-3 flex-shrink-0"><i class="fas fa-coffee text-xs"></i></div><div class="sketch-card p-3 flex-1 relative"><div class="absolute top-2 right-2 text-gray-300 cursor-pointer" onclick="editNote('card-d2-6')"><i class="fas fa-edit"></i></div><span class="text-[10px] font-bold bg-gray-100 px-1.5 py-0.5 rounded text-gray-600 mb-1 inline-block"><i class="far fa-clock mr-1"></i>16:30</span><h4 class="font-bold">GOLPIE COFFEE</h4><p class="text-xs text-gray-500">å·åå±±å† è»å’–å•¡</p><a href="https://www.google.com/maps/search/?api=1&query=GOLPIE+COFFEE" target="_blank" class="inline-block text-[10px] bg-white px-2 py-1 rounded border border-gray-300 mt-2 hover:bg-gray-50 text-gray-600"><i class="fas fa-map-marker-alt text-red-500 mr-1"></i>é–‹å•Ÿ Google Maps</a><div class="note-area mt-2 text-xs text-blue-600 font-bold hidden"></div></div></div>
                <div class="relative flex items-start mb-6"><div class="timeline-travel">ğŸšƒ ç§»å‹•ç´„ 30åˆ†</div></div>
                <div class="relative flex items-start mb-6" id="card-d2-7"><div class="bg-gray-800 text-white border-2 border-black w-8 h-8 rounded-full flex items-center justify-center z-10 mr-3 flex-shrink-0"><i class="fas fa-beer text-xs"></i></div><div class="sketch-card p-3 flex-1 relative"><div class="absolute top-2 right-2 text-gray-300 cursor-pointer" onclick="editNote('card-d2-7')"><i class="fas fa-edit"></i></div><span class="text-[10px] font-bold bg-gray-700 text-gray-300 px-1.5 py-0.5 rounded mb-1 inline-block"><i class="far fa-clock mr-1"></i>18:30</span><h4 class="font-bold">ä¸–ç•Œçš„å±±å°‡</h4><p class="text-xs text-gray-500">å¤¢å¹»æ‰‹ç¾½å…ˆ</p><a href="https://www.google.com/maps/search/?api=1&query=Sekai+no+Yamachan" target="_blank" class="inline-block text-[10px] bg-white px-2 py-1 rounded border border-gray-300 mt-2 hover:bg-gray-50 text-gray-600"><i class="fas fa-map-marker-alt text-red-500 mr-1"></i>é–‹å•Ÿ Google Maps</a><div class="note-area mt-2 text-xs text-blue-600 font-bold hidden"></div></div></div></div><div class="map-container"><h4 class="absolute top-2 left-3 font-bold text-[10px] bg-white px-2 py-1 border border-black rounded z-10">Day 2 Route</h4><svg viewBox="0 0 350 400" class="w-full h-full"><path d="M 120 0 Q 110 200 130 400" fill="none" stroke="#e0f2fe" stroke-width="20"/><path d="M 60 0 L 60 400" fill="none" stroke="#777" stroke-width="2" stroke-dasharray="4,4" /><path d="M 210 350 Q 160 320 60 250" fill="none" stroke="#ec4899" stroke-width="3" stroke-dasharray="8,5" class="path-line" marker-end="url(#arrow-pink)" /><path d="M 60 250 Q 60 150 180 50" fill="none" stroke="#ec4899" stroke-width="3" stroke-dasharray="8,5" class="path-line" marker-end="url(#arrow-pink)" /><path d="M 180 50 Q 300 200 280 300" fill="none" stroke="#ec4899" stroke-width="3" stroke-dasharray="8,5" class="path-line" marker-end="url(#arrow-pink)" /><path d="M 280 300 Q 250 340 210 350" fill="none" stroke="#ec4899" stroke-width="3" stroke-dasharray="8,5" class="path-line" marker-end="url(#arrow-pink)" /><text x="160" y="50" font-size="24">ğŸ¯</text><text x="40" y="230" font-size="28">ğŸš‰</text><text x="60" y="255" text-anchor="middle" font-size="10" font-weight="bold" class="station-label">åç«™</text><text x="270" y="280" font-size="18">â˜•</text><text x="300" y="300" text-anchor="middle" font-size="10" font-weight="bold" class="station-label">Golpie</text><text x="160" y="330" font-size="28">ğŸš‰</text><text x="180" y="355" text-anchor="middle" font-size="10" font-weight="bold" class="station-label">ä¸Šå‰æ´¥</text><g transform="translate(210, 350)"><path d="M 0 15 L 15 0 L 30 15 L 30 30 L 0 30 Z" fill="white" stroke="#1a1a1a" stroke-width="2"/><text x="15" y="45" text-anchor="middle" font-size="9" font-weight="bold" fill="#22c55e" class="station-label">ä½å®¿</text></g><text x="50" y="380" font-size="18">ğŸŒ²</text><text x="280" y="100" font-size="18">ğŸŒ²</text></svg></div></div>`;
            } else {
                // DAY 3 HTML
                html = `<div id="day3-detail" class="day-detail"><h3 class="font-black text-xl mb-4 border-l-4 border-yellow-400 pl-3">ååŸèˆ‡è³¼ç‰©</h3><div class="relative pl-2"><div class="timeline-line"></div>
                <div class="relative flex items-start mb-6" id="card-d3-1"><div class="bg-white border-2 border-black w-8 h-8 rounded-full flex items-center justify-center z-10 mr-3 flex-shrink-0"><span class="font-bold text-xs">08:00</span></div><div class="sketch-card p-3 flex-1 relative"><div class="absolute top-2 right-2 text-gray-300 cursor-pointer" onclick="editNote('card-d3-1')"><i class="fas fa-edit"></i></div><span class="text-[10px] font-bold bg-gray-100 px-1.5 py-0.5 rounded text-gray-600 mb-1 inline-block"><i class="far fa-clock mr-1"></i>08:00</span><h4 class="font-bold">Karasu</h4><p class="text-xs text-gray-500">å­¤ç¨çš„ç¾é£Ÿå®¶å’–å•¡å»³</p><a href="https://www.google.com/maps/search/?api=1&query=Coffee+Shop+Karasu+Nagoya" target="_blank" class="inline-block text-[10px] bg-white px-2 py-1 rounded border border-gray-300 mt-2 hover:bg-gray-50 text-gray-600"><i class="fas fa-map-marker-alt text-red-500 mr-1"></i>é–‹å•Ÿ Google Maps</a><div class="note-area mt-2 text-xs text-blue-600 font-bold hidden"></div></div></div>
                <div class="relative flex items-start mb-6"><div class="timeline-travel">ğŸšƒ ç§»å‹•ç´„ 20åˆ†</div></div>
                <div class="relative flex items-start mb-6" id="card-d3-2"><div class="bg-yellow-100 border-2 border-black w-8 h-8 rounded-full flex items-center justify-center z-10 mr-3 flex-shrink-0"><i class="fas fa-landmark text-xs"></i></div><div class="sketch-card p-3 flex-1 relative"><div class="absolute top-2 right-2 text-gray-300 cursor-pointer" onclick="editNote('card-d3-2')"><i class="fas fa-edit"></i></div><span class="text-[10px] font-bold bg-gray-100 px-1.5 py-0.5 rounded text-gray-600 mb-1 inline-block"><i class="far fa-clock mr-1"></i>09:30</span><h4 class="font-bold">åå¤å±‹åŸ</h4><p class="text-xs text-gray-500">é‡‘é¯±èˆ‡æœ¬ä¸¸å¾¡æ®¿</p><div class="text-[10px] text-blue-600 font-bold mt-1"><i class="fas fa-ticket-alt mr-1"></i>é–€ç¥¨: Â¥500</div><a href="https://www.google.com/maps/search/?api=1&query=Nagoya+Castle" target="_blank" class="inline-block text-[10px] bg-white px-2 py-1 rounded border border-gray-300 mt-2 hover:bg-gray-50 text-gray-600"><i class="fas fa-map-marker-alt text-red-500 mr-1"></i>é–‹å•Ÿ Google Maps</a><div class="note-area mt-2 text-xs text-blue-600 font-bold hidden"></div></div></div>
                <div class="relative flex items-start mb-6"><div class="timeline-travel">ğŸšŒ ç§»å‹•ç´„ 20åˆ†</div></div>
                <div class="relative flex items-start mb-6" id="card-d3-3"><div class="bg-green-100 border-2 border-black w-8 h-8 rounded-full flex items-center justify-center z-10 mr-3 flex-shrink-0"><i class="fas fa-tree text-xs"></i></div><div class="sketch-card p-3 flex-1 relative"><div class="absolute top-2 right-2 text-gray-300 cursor-pointer" onclick="editNote('card-d3-3')"><i class="fas fa-edit"></i></div><span class="text-[10px] font-bold bg-gray-100 px-1.5 py-0.5 rounded text-gray-600 mb-1 inline-block"><i class="far fa-clock mr-1"></i>11:30</span><h4 class="font-bold">å¾·å·åœ’</h4><p class="text-xs text-gray-500">æ—¥å¼åº­åœ’æ•£æ­¥</p><div class="text-[10px] text-blue-600 font-bold mt-1"><i class="fas fa-ticket-alt mr-1"></i>é–€ç¥¨: Â¥300</div><a href="https://www.google.com/maps/search/?api=1&query=Tokugawaen" target="_blank" class="inline-block text-[10px] bg-white px-2 py-1 rounded border border-gray-300 mt-2 hover:bg-gray-50 text-gray-600"><i class="fas fa-map-marker-alt text-red-500 mr-1"></i>é–‹å•Ÿ Google Maps</a><div class="note-area mt-2 text-xs text-blue-600 font-bold hidden"></div></div></div>
                <div class="relative flex items-start mb-6"><div class="timeline-travel">ğŸšƒ ç§»å‹•ç´„ 30åˆ†</div></div>
                <div class="relative flex items-start mb-6" id="card-d3-4"><div class="bg-white border-2 border-black w-8 h-8 rounded-full flex items-center justify-center z-10 mr-3 flex-shrink-0"><i class="fas fa-utensils text-xs"></i></div><div class="sketch-card p-3 flex-1 relative"><div class="absolute top-2 right-2 text-gray-300 cursor-pointer" onclick="editNote('card-d3-4')"><i class="fas fa-edit"></i></div><span class="text-[10px] font-bold bg-gray-100 px-1.5 py-0.5 rounded text-gray-600 mb-1 inline-block"><i class="far fa-clock mr-1"></i>13:30</span><h4 class="font-bold">Yellow</h4><p class="text-xs text-gray-500">å‰‡æ­¦æ–°ç”º æ¿ƒåšæ­å§†è›‹åŒ…é£¯</p><a href="https://www.google.com/maps/search/?api=1&query=Yellow+Tomato+Curried+Rice+Nagoya" target="_blank" class="inline-block text-[10px] bg-white px-2 py-1 rounded border border-gray-300 mt-2 hover:bg-gray-50 text-gray-600"><i class="fas fa-map-marker-alt text-red-500 mr-1"></i>é–‹å•Ÿ Google Maps</a><div class="note-area mt-2 text-xs text-blue-600 font-bold hidden"></div></div></div>
                <div class="relative flex items-start mb-6"><div class="timeline-travel">ğŸšƒ ç§»å‹•ç´„ 15åˆ†</div></div>
                <div class="relative flex items-start mb-6" id="card-d3-5"><div class="bg-purple-100 border-2 border-black w-8 h-8 rounded-full flex items-center justify-center z-10 mr-3 flex-shrink-0"><i class="fas fa-shopping-bag text-xs"></i></div><div class="sketch-card p-3 flex-1 relative"><div class="absolute top-2 right-2 text-gray-300 cursor-pointer" onclick="editNote('card-d3-5')"><i class="fas fa-edit"></i></div><span class="text-[10px] font-bold bg-gray-100 px-1.5 py-0.5 rounded text-gray-600 mb-1 inline-block"><i class="far fa-clock mr-1"></i>15:00</span><h4 class="font-bold">æ¦® (Sakae)</h4><p class="text-xs text-gray-500">LACHIC, ä¸­æ—¥å¤§æ¨“</p><a href="https://www.google.com/maps/search/?api=1&query=Sakae+Nagoya" target="_blank" class="inline-block text-[10px] bg-white px-2 py-1 rounded border border-gray-300 mt-2 hover:bg-gray-50 text-gray-600"><i class="fas fa-map-marker-alt text-red-500 mr-1"></i>é–‹å•Ÿ Google Maps</a><div class="note-area mt-2 text-xs text-blue-600 font-bold hidden"></div></div></div>
                <div class="relative flex items-start mb-6"><div class="timeline-travel">ğŸšƒ ç§»å‹•ç´„ 10åˆ†</div></div>
                <div class="relative flex items-start mb-6" id="card-d3-6"><div class="bg-orange-100 border-2 border-black w-8 h-8 rounded-full flex items-center justify-center z-10 mr-3 flex-shrink-0"><i class="fas fa-shrimp text-xs"></i></div><div class="sketch-card p-3 flex-1 relative"><div class="absolute top-2 right-2 text-gray-300 cursor-pointer" onclick="editNote('card-d3-6')"><i class="fas fa-edit"></i></div><span class="text-[10px] font-bold bg-gray-100 px-1.5 py-0.5 rounded text-gray-600 mb-1 inline-block"><i class="far fa-clock mr-1"></i>18:00</span><h4 class="font-bold">æµ·è€ã©ã¦é£Ÿå ‚</h4><p class="text-xs text-gray-500">35cm ç‰¹å¤§ç‚¸è¦</p><a href="https://www.google.com/maps/search/?api=1&query=Ebidote+Shokudo" target="_blank" class="inline-block text-[10px] bg-white px-2 py-1 rounded border border-gray-300 mt-2 hover:bg-gray-50 text-gray-600"><i class="fas fa-map-marker-alt text-red-500 mr-1"></i>é–‹å•Ÿ Google Maps</a><div class="note-area mt-2 text-xs text-blue-600 font-bold hidden"></div></div></div></div><div class="map-container"><h4 class="absolute top-2 left-3 font-bold text-[10px] bg-white px-2 py-1 border border-black rounded z-10">Day 3 Route</h4><svg viewBox="0 0 350 400" class="w-full h-full"><path d="M 120 0 Q 110 200 130 400" fill="none" stroke="#e0f2fe" stroke-width="20"/><line x1="0" y1="200" x2="350" y2="200" stroke="#e5e5e5" stroke-width="12"/><line x1="230" y1="0" x2="230" y2="400" stroke="#e5e5e5" stroke-width="12"/><path d="M 210 350 Q 200 250 120 100" fill="none" stroke="#4ade80" stroke-width="4" stroke-dasharray="6,8" class="path-line" marker-end="url(#arrow-green)" /><path d="M 120 100 Q 200 80 280 120" fill="none" stroke="#4ade80" stroke-width="4" stroke-dasharray="6,8" class="path-line" marker-end="url(#arrow-green)" /><path d="M 280 120 Q 280 180 230 220" fill="none" stroke="#4ade80" stroke-width="4" stroke-dasharray="6,8" class="path-line" marker-end="url(#arrow-green)" /><path d="M 230 220 Q 240 300 210 350" fill="none" stroke="#4ade80" stroke-width="4" stroke-dasharray="6,8" class="path-line" marker-end="url(#arrow-green)" /><text x="120" y="90" font-size="24">ğŸ‹</text><text x="110" y="80" font-size="10" font-weight="bold" class="station-label">ååŸ</text><text x="280" y="110" text-anchor="middle" font-size="10" font-weight="bold" class="station-label">å¾·å·åœ’</text><text x="210" y="200" font-size="28">ğŸš‰</text><text x="230" y="225" text-anchor="middle" font-size="10" font-weight="bold" class="station-label">æ¦®</text><circle cx="120" cy="100" r="8" fill="#4ade80" stroke="white" stroke-width="2"/> <text x="120" y="104" text-anchor="middle" font-size="10" font-weight="bold" fill="white">1</text><circle cx="280" cy="120" r="8" fill="#4ade80" stroke="white" stroke-width="2"/> <text x="280" y="124" text-anchor="middle" font-size="10" font-weight="bold" fill="white">2</text><circle cx="230" cy="220" r="8" fill="#4ade80" stroke="white" stroke-width="2" transform="translate(15,-10)"/> <text x="245" y="214" text-anchor="middle" font-size="10" font-weight="bold" fill="white">3</text><text x="160" y="330" font-size="28">ğŸš‰</text><text x="180" y="355" text-anchor="middle" font-size="10" font-weight="bold" class="station-label">ä¸Šå‰æ´¥</text><path d="M 190 340 Q 205 345 210 355" fill="none" stroke="black" stroke-width="1.5" stroke-dasharray="3,2" /><g transform="translate(210, 350)"><path d="M 0 15 L 15 0 L 30 15" fill="none" stroke="#1a1a1a" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" /><path d="M 5 15 L 5 30 L 25 30 L 25 15" fill="none" stroke="#1a1a1a" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" /><text x="15" y="45" text-anchor="middle" font-size="9" font-weight="bold" fill="#22c55e" class="station-label">ä½å®¿</text></g></svg></div></div>`;
            }
            contentDiv.innerHTML = html;
            renderNotes();
        }

        // ================= WALLET =================
        let budget = localStorage.getItem('nagoya_budget') || 0;
        document.getElementById('budget-input').value = budget > 0 ? budget : '';
        const calcInput = document.getElementById('calc-input');
        const calcResult = document.getElementById('calc-result');

        function updateBudget() {
            budget = parseFloat(document.getElementById('budget-input').value) || 0;
            localStorage.setItem('nagoya_budget', budget);
            renderExpenses();
        }

        calcInput.addEventListener('input', (e) => {
            try {
                const val = e.target.value.replace(/[^0-9+\-*/.]/g, ''); 
                if(!val) { calcResult.textContent = '0'; return; }
                const res = Function('"use strict";return (' + val + ')')();
                calcResult.textContent = Math.round(res * exchangeRate).toLocaleString();
            } catch(e) {}
        });

        function updateCategoryIcon(select) {
            const icons = { food: 'fa-utensils', shopping: 'fa-shopping-bag', transport: 'fa-train', accommodation: 'fa-bed', other: 'fa-ellipsis-h' };
            document.getElementById('category-icon').className = `fas ${icons[select.value]} text-lg`;
        }
        function updateCurrencySymbol(select) {
            document.getElementById('currency-symbol').textContent = select.value === 'JPY' ? 'Â¥' : '$';
        }

        let expensesData = JSON.parse(localStorage.getItem('nagoya_expenses_v2')) || { food:[], shopping:[], transport:[], accommodation:[], other:[] };

        function addExpense() {
            const desc = document.getElementById('expense-item').value.trim();
            const amount = parseFloat(document.getElementById('expense-amount').value);
            const category = document.getElementById('expense-category').value;
            const currency = document.getElementById('expense-currency').value;
            const photo = document.getElementById('expense-photo-base64').value;
            const isShared = document.getElementById('expense-shared').checked;

            if(!desc || !amount) { alert('è«‹è¼¸å…¥åç¨±èˆ‡é‡‘é¡'); return; }

            if (!expensesData[category]) expensesData[category] = [];
            expensesData[category].push({ desc, amount, currency, photo, isShared, date: new Date().toISOString() });
            localStorage.setItem('nagoya_expenses_v2', JSON.stringify(expensesData));

            // Reset
            document.getElementById('expense-item').value = '';
            document.getElementById('expense-amount').value = '';
            document.getElementById('expense-photo').value = '';
            document.getElementById('expense-photo-base64').value = '';
            document.getElementById('expense-shared').checked = false;
            document.getElementById('photo-label').textContent = "ä¸Šå‚³ç…§ç‰‡";
            document.getElementById('photo-label').classList.remove('text-green-600', 'font-bold');
            renderExpenses();
        }

        function deleteExpense(catId, index) {
            if(confirm('åˆªé™¤æ­¤ç­†ï¼Ÿ')) {
                expensesData[catId].splice(index, 1);
                localStorage.setItem('nagoya_expenses_v2', JSON.stringify(expensesData));
                renderExpenses();
            }
        }

        function renderExpenses() {
            const container = document.getElementById('expenses-container');
            container.innerHTML = '';
            let totalTWD = 0, totalJPY = 0;
            let catTotals = {};

            expenseCategories.forEach(cat => {
                let catTotalJPY = 0;
                let html = `<div class="sketch-card p-4 ${cat.color}"><div class="flex items-center gap-2 mb-3 border-b-2 border-black pb-2"><i class="fas ${cat.icon} text-xl"></i><h3 class="font-bold text-lg">${cat.name}</h3></div><div class="space-y-2">`;
                
                if(expensesData[cat.id] && expensesData[cat.id].length > 0) {
                    expensesData[cat.id].forEach((item, idx) => {
                        const isJpy = item.currency === 'JPY';
                        const valJpy = isJpy ? item.amount : item.amount / exchangeRate;
                        const valTwd = isJpy ? item.amount * exchangeRate : item.amount;
                        catTotalJPY += valJpy;
                        totalJPY += valJpy;
                        totalTWD += valTwd;

                        html += `<div class="expense-row"><div class="flex items-center gap-2">${item.photo ? '<i class="fas fa-image text-gray-400"></i>' : ''}<span class="font-bold text-sm ${item.isShared ? 'text-green-700':''}">${item.desc} ${item.isShared ? '(å…¬)' : ''}</span></div><div class="flex items-center"><span class="font-black mr-2 text-sm">${isJpy ? 'Â¥' : '$'}${item.amount}</span><i class="fas fa-trash-alt delete-btn text-xs" onclick="deleteExpense('${cat.id}', ${idx})"></i></div></div>`;
                    });
                } else { html += `<div class="text-xs text-gray-400 italic">ç„¡ç´€éŒ„</div>`; }
                html += `</div></div>`;
                catTotals[cat.id] = catTotalJPY;
                container.innerHTML += html;
            });

            document.getElementById('total-jpy').textContent = Math.round(totalJPY).toLocaleString();
            document.getElementById('total-twd').textContent = Math.round(totalTWD).toLocaleString();
            document.getElementById('budget-spent').textContent = Math.round(totalTWD).toLocaleString();

            if (budget > 0) {
                const left = budget - totalTWD;
                document.getElementById('budget-left').textContent = Math.round(left).toLocaleString();
                const pct = Math.min((totalTWD / budget) * 100, 100);
                const bar = document.getElementById('budget-bar');
                bar.style.width = `${pct}%`;
                bar.className = `h-full transition-all duration-500 ${totalTWD > budget ? 'bg-red-500' : 'bg-green-500'}`;
            }
            
            // Render Pie Chart
            if (totalJPY > 0) {
                let currentAngle = 0;
                let gradientString = '';
                let legendHtml = '';
                
                expenseCategories.forEach((cat) => {
                    const catTotal = catTotals[cat.id] || 0;
                    if (catTotal > 0) {
                        const percent = (catTotal / totalJPY) * 100;
                        const endAngle = currentAngle + percent;
                        gradientString += `${cat.chartColor} ${currentAngle}% ${endAngle}%, `;
                        currentAngle = endAngle;
                        legendHtml += `
                            <div class="flex items-center gap-1">
                                <div class="w-3 h-3 rounded-full" style="background-color: ${cat.chartColor}"></div>
                                <span>${cat.name} (${Math.round(percent)}%)</span>
                            </div>
                        `;
                    }
                });
                gradientString = gradientString.slice(0, -2); // Remove trailing comma

                const chartSection = document.createElement('div');
                chartSection.innerHTML = `
                    <div class="sketch-card p-4 mt-6 bg-white mb-24 relative overflow-hidden">
                        <h3 class="font-bold text-lg mb-4 text-center border-b-2 border-dashed border-gray-300 pb-2">
                            <i class="fas fa-chart-pie mr-2"></i>æ”¯å‡ºåˆ†ä½ˆ (JPY)
                        </h3>
                        <div class="flex items-center justify-center py-2">
                            <div class="w-40 h-40 rounded-full border-2 border-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)]" 
                                 style="background: conic-gradient(${gradientString})">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-2 mt-4 text-xs justify-items-center">
                            ${legendHtml}
                        </div>
                    </div>
                `;
                container.appendChild(chartSection);
            }
        }

        // ================= UTILS & EXTRAS =================
        function handlePhotoUpload(input) {
            if(input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        const scale = 300 / img.width;
                        canvas.width = 300; canvas.height = img.height * scale;
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        document.getElementById('expense-photo-base64').value = canvas.toDataURL('image/jpeg', 0.6);
                        document.getElementById('photo-label').textContent = "å·²é¸";
                        document.getElementById('photo-label').classList.add('text-green-600');
                    }
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function toggleModal(id) {
            const m = document.getElementById(id);
            m.style.display = m.style.display === 'flex' ? 'none' : 'flex';
        }

        function showTranslation(icon, jp, zh) {
            document.getElementById('trans-icon').textContent = icon;
            document.getElementById('trans-jp').textContent = jp;
            document.getElementById('trans-zh').textContent = zh;
            toggleModal('modal-trans');
        }

        // Smart Status Logic
        function updateSmartStatus() {
            const now = new Date();
            const start = new Date('2026-03-02');
            const end = new Date('2026-03-06');
            const statusEl = document.getElementById('smart-status');
            
            if (now < start) {
                const diff = Math.ceil((start - now) / (1000 * 60 * 60 * 24));
                statusEl.textContent = `è·é›¢å‡ºç™¼é‚„æœ‰ ${diff} å¤©ï¼`;
            } else if (now >= start && now <= end) {
                statusEl.textContent = "æ—…ç¨‹é€²è¡Œä¸­ âœˆï¸ äº«å—ç•¶ä¸‹ï¼";
                statusEl.classList.add('text-green-600');
            } else {
                statusEl.textContent = "æ—…ç¨‹å·²çµæŸï¼Œæ­¡è¿å›å®¶ ğŸ ";
                statusEl.classList.remove('animate-pulse');
            }
        }

        function updateCountdown() {
            const targetDate = new Date('2026-03-02T16:45:00').getTime();
            const now = new Date().getTime();
            const distance = targetDate - now;
            const el = document.getElementById('countdown-timer');
            if(!el) return;
            if (distance < 0) { el.innerHTML = "æ—…ç¨‹å·²é–‹å§‹ï¼"; return; }
            const d = Math.floor(distance / (1000 * 60 * 60 * 24));
            const h = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const m = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            
            el.innerHTML = `${d}å¤© ${h}æ™‚ ${m}åˆ†`;
        }

        // Export/Import
        function exportCSV() {
            let csv = '\uFEFFCategory,Description,Amount,Currency,Date\n';
            Object.keys(expensesData).forEach(cat => {
                expensesData[cat].forEach(item => {
                    csv += `${cat},${item.desc},${item.amount},${item.currency},${item.date}\n`;
                });
            });
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "nagoya_expenses.csv";
            link.click();
        }

        function generateQRCode() {
            const data = { exp: expensesData, chk: JSON.parse(localStorage.getItem('nagoya_checklist')) };
            const str = JSON.stringify(data);
            document.getElementById('qrcode').innerHTML = '';
            new QRCode(document.getElementById("qrcode"), {
                text: str, width: 200, height: 200
            });
        }
        
        // Function stubs to prevent errors for unused buttons in this snippet
        function exportData() { 
            const str = JSON.stringify(expensesData);
            navigator.clipboard.writeText(str).then(()=>alert('å·²è¤‡è£½')); 
        }
        function importData() {
            const str = prompt('è²¼ä¸Šä»£ç¢¼');
            if(str) { 
                try { 
                    expensesData = JSON.parse(str); 
                    localStorage.setItem('nagoya_expenses_v2', JSON.stringify(expensesData));
                    renderExpenses();
                } catch(e) { alert('éŒ¯èª¤'); }
            }
        }
        
        let itineraryNotes = JSON.parse(localStorage.getItem('nagoya_itinerary_notes')) || {};
        function editNote(id) {
            const note = prompt("ç­†è¨˜:", itineraryNotes[id] || "");
            if(note !== null) {
                itineraryNotes[id] = note;
                localStorage.setItem('nagoya_itinerary_notes', JSON.stringify(itineraryNotes));
                renderNotes();
            }
        }
        function renderNotes() {
            for(let id in itineraryNotes) {
                const el = document.querySelector(`#${id} .note-area`);
                if(el && itineraryNotes[id]) {
                    el.textContent = "ğŸ“ " + itineraryNotes[id];
                    el.classList.remove('hidden');
                }
            }
        }
        
        function renderChecklist() {} // Placeholder if needed, logic is in v1
        function parseMemoLinks() {} // Placeholder
        async function fetchWeather() {} // Placeholder
        function findNearestHelp() { alert('å®šä½åŠŸèƒ½å•Ÿå‹• (éœ€ HTTPS)'); }

    </script>
</body>
</html>